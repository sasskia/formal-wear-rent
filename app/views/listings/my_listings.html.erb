
<% content_for :navbar do %>
      <%= render 'shared/navbar_white' %>
 <% end %>

<div class="container">
                     
  <h2>My new booking requests</h2>
    <% pending = 0 %>
    <% confirmed = 0 %>
    <% listings = 0 %>
    <% @listings.each do |listing| %>

      <%listing.bookings.each do |booking| %>
        <% if booking.confirmed.nil? %>
          <p><%=booking.listing.name %></p>
          <p><%=booking.start_date%> - <%=booking.end_date %></p>
          <p><%=booking.user.first_name %> <%= booking.user.last_name %> @ <%=booking.user.university %></p>
          <p>Contact: <%=booking.user.email%></p>
          <%= link_to booking_confirm_path(booking.id), method: :patch, data: { confirm: 'Are you sure you want to accept?'}, class: "btn btn-success" do %>
            Confirm
          <% end %>
          <%= link_to booking_decline_path(booking.id), method: :patch, data: { confirm: 'Are you sure you want to decline?'}, class: "btn btn-danger" do %>
            Decline
            <% pending += 1 %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  <% if pending == 0 %>
    <p>No pending Requests</p>
  <% end %>


  <h2>My confirmed booking requests</h2>

  <% @listings.each do |listing| %>
    <%listing.bookings.each do |booking| %>
      <% if booking.confirmed == true %>
        <p><%=booking.listing.name %></p>
        <p><%=booking.start_date%> - <%=booking.end_date %></p>
        <p><%=booking.user.first_name %> <%= booking.user.last_name %> @ <%=booking.user.university %></p>
        <p>Contact: <%=booking.user.email%></p>
        <% confirmed += 1 %>
      <% end %>
    <% end %>
  <% end %>
  <% if pending == 0 %>
    <p>No confirmed bookings</p>
  <% end %>

  <h2>My rented out items</h2>

  <% @listings.each do |listing| %>
      <%listing.bookings.each do |booking| %>
        <% if booking.confirmed == true %>
          <p><%=booking.listing.name %></p>
          <p><%=booking.start_date%> - <%=booking.end_date %></p>
          <p><%=booking.user.first_name %> <%= booking.user.last_name %> @ <%=booking.user.university %></p>
          <p>Contact: <%=booking.user.email%></p>
        <% end %>

        <% listings += 1 %>
      </li>
    <% end %>
  <% end %>

  <% if listings == 0 %>
    <p>No Listings Requests</p>
  <% end %>

  <div class="d-flex">
    <h2 class="mr-3">My Listings</h2>
    <%= link_to "Add a listing", new_listing_path(), class: "btn btn-primary add_a_listing" %>
  </div>

  <div class="my-listings-container">
    
    <% @listings.each do |listing| %>
      <div class="card_price-container">

        <%= link_to edit_listing_path(listing) do %>
          <i class="fas fa-pen" id="edit_button"></i>
        <% end %>

        <%= link_to listing_path(listing), method: :delete, data: { confirm: "Delete #{listing.name}?" } do %>
          <i class="fas fa-trash" id="delete_button"></i>
        <% end %>

        <p  class=card-my-listing-price> $ <%= listing.price_per_night %> per night</p>

        <%= link_to listing_path(listing.id) do%>

          <div class="card-my-listing">
            <div class="content">
              <h2 class="title"><%= listing.name %></h2>
              <p class="card-my-listing-info"><%= listing.description %></p>
              <p class="card-my-listing-info"><%= listing.category %></p>
            </div>
          </div>

        <% end %>
      </div>
    <% end %>

  </div>

</div>
